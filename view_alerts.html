<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>View Alerts</title>
  <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #ecfdf5;
      color: #065f46;
      padding: 2rem;
      margin: 0;
    }
    header {
      background-color: #10b981;
      color: white;
      padding: 1.2rem 2rem;
      font-family: 'Black Ops One', sans-serif;
      font-size: 1.6rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .location-info {
      font-size: 0.9rem;
      font-family: 'Segoe UI', sans-serif;
    }
    section {
      background: white;
      border: 2px solid #a7f3d0;
      border-radius: 20px;
      padding: 2rem;
      max-width: 1200px;
      margin: 2rem auto;
    }
    .controls {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }
    .btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 25px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s;
    }
    .btn:hover {
      background: #059669;
    }
    .btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .weather-section {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border: 2px solid #3b82f6;
      border-radius: 15px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .weather-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .weather-icon {
      font-size: 2rem;
      color: #1e40af;
    }
    .weather-title {
      color: #1e40af;
      margin: 0;
    }
    .current-weather {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    .weather-card {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }
    .weather-card h4 {
      margin: 0 0 0.5rem 0;
      color: #1e40af;
      font-size: 0.9rem;
    }
    .weather-card .value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #1e40af;
    }
    .weather-card .unit {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .forecast-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    .forecast-day {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }
    .forecast-day h5 {
      margin: 0 0 0.5rem 0;
      color: #1e40af;
      font-size: 0.9rem;
    }
    .forecast-icon {
      font-size: 2rem;
      margin: 0.5rem 0;
    }
    .forecast-temp {
      font-weight: bold;
      color: #1e40af;
    }
    .alert {
      background: #fef3c7;
      border-left: 6px solid #facc15;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
    }
    .alert.weather-alert {
      background: #fee2e2;
      border-left-color: #ef4444;
    }
    .alert.weather-alert strong {
      color: #dc2626;
    }
    .alert strong {
      display: block;
      margin-bottom: 0.5rem;
    }
    .loading {
      text-align: center;
      padding: 2rem;
      color: #6b7280;
    }
    .error {
      background: #fee2e2;
      border: 1px solid #ef4444;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      color: #dc2626;
    }
    .location-status {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      display: none;
    }
    .weather-alerts {
      margin: 1.5rem 0;
    }
    .weather-alerts h3 {
      color: #dc2626;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <span>View Alerts</span>
    <div class="location-info">
      <span id="location-status">üìç Detecting location...</span>
    </div>
  </header>

  <section>
    <div class="controls">
      <button class="btn" id="detect-location">üìç Detect My Location</button>
      <button class="btn" id="refresh-weather">üå§Ô∏è Refresh Weather</button>
      <button class="btn" id="show-forecast">üìÖ Show 5-Day Forecast</button>
    </div>

    <div id="location-status-box" class="location-status">
      <h3>üìç Current Location</h3>
      <p id="coordinates">Loading coordinates...</p>
      <p id="address">Loading address...</p>
    </div>

    <!-- Weather Section -->
    <div class="weather-section">
      <div class="weather-header">
        <i class="fas fa-cloud-sun weather-icon"></i>
        <h2 class="weather-title">Current Weather</h2>
      </div>
      
      <div class="demo-notice" style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 0.8rem; margin: 1rem 0; font-size: 0.9rem; color: #92400e;">
        <i class="fas fa-info-circle"></i> 
        <strong>Demo Mode:</strong> Currently showing sample weather data. 
        <a href="https://openweathermap.org/api" target="_blank" style="color: #1e40af; text-decoration: underline;">Get free API key</a> for real-time weather.
      </div>
      
      <div id="weather-loading" class="loading">
        <i class="fas fa-spinner fa-spin"></i> Loading weather data...
      </div>
      
      <div id="weather-error" class="error" style="display: none;">
        Unable to load weather data. Please try again.
      </div>
      
      <div id="current-weather" class="current-weather" style="display: none;">
        <!-- Weather cards will be populated here -->
      </div>
      
      <div id="forecast-container" class="forecast-container" style="display: none;">
        <!-- 5-day forecast will be populated here -->
      </div>
    </div>

    <!-- Weather Alerts Section -->
    <div class="weather-alerts">
      <h3><i class="fas fa-exclamation-triangle"></i> Weather Alerts</h3>
      <div id="weather-alerts-list">
        <div class="loading">Loading weather alerts...</div>
      </div>
    </div>

    <h2>Latest Disaster Alerts</h2>
    <div class="alert">
      <strong>Flood Warning</strong>
      Evacuate low-lying areas near Riverbank by 6 PM. Emergency shelters are open at Community Center and School Gym.
    </div>
    <div class="alert">
      <strong>Power Outage</strong>
      City Grid 3 experiencing disruption. Restoration expected within 8 hours. Use backup sources if available.
    </div>
  </section>

  <script>
    let currentLocation = null;
    let weatherData = null;
    
    // Weather API configuration - Using free services
    const WEATHER_BASE_URL = 'https://api.openweathermap.org/data/2.5';
    const WEATHER_API_KEY = 'demo'; // Demo mode for now
    
    // Get user's current location
    function detectLocation() {
      const statusBox = document.getElementById('location-status-box');
      const statusText = document.getElementById('location-status');
      const coordinatesText = document.getElementById('coordinates');
      const addressText = document.getElementById('address');

      statusText.textContent = 'üìç Detecting location...';
      statusBox.style.display = 'block';

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            currentLocation = { lat: latitude, lng: longitude };
            
            coordinatesText.textContent = `Coordinates: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
            statusText.textContent = 'üìç Location detected!';
            
            // Get address using reverse geocoding
            getAddressFromCoordinates(latitude, longitude, addressText);
            
            // Fetch weather data for the location
            fetchWeatherData(latitude, longitude);
            
            // Fetch weather alerts
            fetchWeatherAlerts(latitude, longitude);
          },
          (error) => {
            console.error('Error getting location:', error);
            statusText.textContent = '‚ùå Location access denied';
            coordinatesText.textContent = 'Unable to get your location. Please enable location access.';
            addressText.textContent = 'Address unavailable';
            
            // Show default weather for RUET area
            fetchWeatherData(24.3636, 88.6241);
            fetchWeatherAlerts(24.3636, 88.6241);
          },
          {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000
          }
        );
      } else {
        statusText.textContent = '‚ùå Geolocation not supported';
        coordinatesText.textContent = 'Your browser does not support location detection.';
        addressText.textContent = 'Address unavailable';
        
        // Show default weather for RUET area
        fetchWeatherData(24.3636, 88.6241);
        fetchWeatherAlerts(24.3636, 88.6241);
      }
    }

    // Get address from coordinates using reverse geocoding
    async function getAddressFromCoordinates(lat, lng, addressElement) {
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`);
        const data = await response.json();
        
        if (data.display_name) {
          addressElement.textContent = `Address: ${data.display_name}`;
        } else {
          addressElement.textContent = 'Address: Location detected';
        }
      } catch (error) {
        console.error('Error getting address:', error);
        addressElement.textContent = 'Address: Location detected';
      }
    }

    // Fetch current weather data
    async function fetchWeatherData(lat, lng) {
      const loadingDiv = document.getElementById('weather-loading');
      const errorDiv = document.getElementById('weather-error');
      const currentWeatherDiv = document.getElementById('current-weather');
      
      try {
        loadingDiv.style.display = 'block';
        errorDiv.style.display = 'none';
        currentWeatherDiv.style.display = 'none';
        
        // Check if we're in demo mode
        if (WEATHER_API_KEY === 'demo') {
          // Simulate API delay for demo
          await new Promise(resolve => setTimeout(resolve, 1000));
          showDemoWeatherData();
          loadingDiv.style.display = 'none';
          return;
        }
        
        // Real API call (when you have a valid API key)
        const response = await fetch(`${WEATHER_BASE_URL}/weather?lat=${lat}&lon=${lng}&appid=${WEATHER_API_KEY}&units=metric`);
        
        if (!response.ok) {
          throw new Error('Weather API error');
        }
        
        const data = await response.json();
        weatherData = data;
        
        displayCurrentWeather(data);
        loadingDiv.style.display = 'none';
        currentWeatherDiv.style.display = 'grid';
        
      } catch (error) {
        console.error('Error fetching weather:', error);
        loadingDiv.style.display = 'none';
        errorDiv.style.display = 'block';
        
        // Show demo weather data for demonstration
        showDemoWeatherData();
      }
    }

    // Fetch 5-day weather forecast
    async function fetchWeatherForecast(lat, lng) {
      try {
        // Check if we're in demo mode
        if (WEATHER_API_KEY === 'demo') {
          // Simulate API delay for demo
          await new Promise(resolve => setTimeout(resolve, 800));
          showDemoForecastData();
          return;
        }
        
        // Real API call (when you have a valid API key)
        const response = await fetch(`${WEATHER_BASE_URL}/forecast?lat=${lat}&lon=${lng}&appid=${WEATHER_API_KEY}&units=metric`);
        
        if (!response.ok) {
          throw new Error('Forecast API error');
        }
        
        const data = await response.json();
        displayWeatherForecast(data);
        
      } catch (error) {
        console.error('Error fetching forecast:', error);
        // Show demo forecast data
        showDemoForecastData();
      }
    }

    // Fetch weather alerts
    async function fetchWeatherAlerts(lat, lng) {
      try {
        // Check if we're in demo mode
        if (WEATHER_API_KEY === 'demo') {
          // Simulate API delay for demo
          await new Promise(resolve => setTimeout(resolve, 600));
          showDemoWeatherAlerts();
          return;
        }
        
        // Real API call (when you have a valid API key)
        const response = await fetch(`${WEATHER_BASE_URL}/onecall?lat=${lat}&lon=${lng}&exclude=current,minutely,hourly,daily&appid=${WEATHER_API_KEY}`);
        
        if (!response.ok) {
          throw new Error('Alerts API error');
        }
        
        const data = await response.json();
        displayWeatherAlerts(data.alerts || []);
        
      } catch (error) {
        console.error('Error fetching alerts:', error);
        // Show demo alerts
        showDemoWeatherAlerts();
      }
    }

    // Display current weather
    function displayCurrentWeather(data) {
      const container = document.getElementById('current-weather');
      
      container.innerHTML = `
        <div class="weather-card">
          <h4>Temperature</h4>
          <div class="value">${Math.round(data.main.temp)}¬∞C</div>
          <div class="unit">Feels like ${Math.round(data.main.feels_like)}¬∞C</div>
        </div>
        <div class="weather-card">
          <h4>Weather</h4>
          <div class="value">${data.weather[0].main}</div>
          <div class="unit">${data.weather[0].description}</div>
        </div>
        <div class="weather-card">
          <h4>Humidity</h4>
          <div class="value">${data.main.humidity}%</div>
          <div class="unit">Relative humidity</div>
        </div>
        <div class="weather-card">
          <h4>Wind</h4>
          <div class="value">${Math.round(data.wind.speed * 3.6)} km/h</div>
          <div class="unit">Wind speed</div>
        </div>
        <div class="weather-card">
          <h4>Pressure</h4>
          <div class="value">${data.main.pressure} hPa</div>
          <div class="unit">Atmospheric pressure</div>
        </div>
        <div class="weather-card">
          <h4>Visibility</h4>
          <div class="value">${(data.visibility / 1000).toFixed(1)} km</div>
          <div class="unit">Visibility range</div>
        </div>
      `;
    }

    // Display weather forecast
    function displayWeatherForecast(data) {
      const container = document.getElementById('forecast-container');
      
      // Group forecast by day and get daily averages
      const dailyForecast = {};
      data.list.forEach(item => {
        const date = new Date(item.dt * 1000).toDateString();
        if (!dailyForecast[date]) {
          dailyForecast[date] = {
            temps: [],
            descriptions: [],
            icons: []
          };
        }
        dailyForecast[date].temps.push(item.main.temp);
        dailyForecast[date].descriptions.push(item.weather[0].description);
        dailyForecast[date].icons.push(item.weather[0].icon);
      });
      
      container.innerHTML = '';
      Object.keys(dailyForecast).slice(0, 5).forEach(date => {
        const dayData = dailyForecast[date];
        const avgTemp = Math.round(dayData.temps.reduce((a, b) => a + b, 0) / dayData.temps.length);
        const mostFrequentDesc = dayData.descriptions.sort((a, b) => 
          dayData.descriptions.filter(v => v === a).length - dayData.descriptions.filter(v => v === b).length
        ).pop();
        
        const dayName = new Date(date).toLocaleDateString('en-US', { weekday: 'short' });
        
        const dayDiv = document.createElement('div');
        dayDiv.className = 'forecast-day';
        dayDiv.innerHTML = `
          <h5>${dayName}</h5>
          <div class="forecast-icon">
            <i class="fas fa-cloud"></i>
          </div>
          <div class="forecast-temp">${avgTemp}¬∞C</div>
          <div class="unit">${mostFrequentDesc}</div>
        `;
        container.appendChild(dayDiv);
      });
      
      container.style.display = 'grid';
    }

    // Display weather alerts
    function displayWeatherAlerts(alerts) {
      const container = document.getElementById('weather-alerts-list');
      
      if (alerts.length === 0) {
        container.innerHTML = '<div class="alert">No weather alerts for your area at this time.</div>';
        return;
      }
      
      container.innerHTML = '';
      alerts.forEach(alert => {
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert weather-alert';
        alertDiv.innerHTML = `
          <strong>${alert.event}</strong>
          <p>${alert.description}</p>
          <small>From: ${new Date(alert.start * 1000).toLocaleString()} - To: ${new Date(alert.end * 1000).toLocaleString()}</small>
        `;
        container.appendChild(alertDiv);
      });
    }

    // Demo weather data for demonstration
    function showDemoWeatherData() {
      const container = document.getElementById('current-weather');
      container.innerHTML = `
        <div class="weather-card">
          <h4>Temperature</h4>
          <div class="value">28¬∞C</div>
          <div class="unit">Feels like 30¬∞C</div>
        </div>
        <div class="weather-card">
          <h4>Weather</h4>
          <div class="value">Partly Cloudy</div>
          <div class="unit">Scattered clouds</div>
        </div>
        <div class="weather-card">
          <h4>Humidity</h4>
          <div class="value">65%</div>
          <div class="unit">Relative humidity</div>
        </div>
        <div class="weather-card">
          <h4>Wind</h4>
          <div class="value">12 km/h</div>
          <div class="unit">Wind speed</div>
        </div>
        <div class="weather-card">
          <h4>Pressure</h4>
          <div class="value">1013 hPa</div>
          <div class="unit">Atmospheric pressure</div>
        </div>
        <div class="weather-card">
          <h4>Visibility</h4>
          <div class="value">10.0 km</div>
          <div class="unit">Visibility range</div>
        </div>
      `;
      container.style.display = 'grid';
    }

    // Demo forecast data
    function showDemoForecastData() {
      const container = document.getElementById('forecast-container');
      container.innerHTML = `
        <div class="forecast-day">
          <h5>Mon</h5>
          <div class="forecast-icon"><i class="fas fa-sun"></i></div>
          <div class="forecast-temp">30¬∞C</div>
          <div class="unit">Clear sky</div>
        </div>
        <div class="forecast-day">
          <h5>Tue</h5>
          <div class="forecast-icon"><i class="fas fa-cloud"></i></div>
          <div class="forecast-temp">28¬∞C</div>
          <div class="unit">Partly cloudy</div>
        </div>
        <div class="forecast-day">
          <h5>Wed</h5>
          <div class="forecast-icon"><i class="fas fa-cloud-rain"></i></div>
          <div class="forecast-temp">25¬∞C</div>
          <div class="unit">Light rain</div>
        </div>
        <div class="forecast-day">
          <h5>Thu</h5>
          <div class="forecast-icon"><i class="fas fa-cloud-sun"></i></div>
          <div class="forecast-temp">27¬∞C</div>
          <div class="unit">Scattered clouds</div>
        </div>
        <div class="forecast-day">
          <h5>Fri</h5>
          <div class="forecast-icon"><i class="fas fa-sun"></i></div>
          <div class="forecast-temp">29¬∞C</div>
          <div class="unit">Clear sky</div>
        </div>
      `;
      container.style.display = 'grid';
    }

    // Demo weather alerts
    function showDemoWeatherAlerts() {
      const container = document.getElementById('weather-alerts-list');
      container.innerHTML = `
        <div class="alert weather-alert">
          <strong>Heat Advisory</strong>
          <p>High temperatures expected. Stay hydrated and avoid prolonged outdoor activities.</p>
          <small>From: Today 12:00 PM - To: Today 6:00 PM</small>
        </div>
        <div class="alert weather-alert">
          <strong>Thunderstorm Watch</strong>
          <p>Thunderstorms possible in the afternoon. Be prepared for sudden weather changes.</p>
          <small>From: Today 2:00 PM - To: Today 8:00 PM</small>
        </div>
      `;
    }

    // Event listeners
    document.getElementById('detect-location').addEventListener('click', detectLocation);
    document.getElementById('refresh-weather').addEventListener('click', () => {
      if (currentLocation) {
        fetchWeatherData(currentLocation.lat, currentLocation.lng);
        fetchWeatherAlerts(currentLocation.lat, currentLocation.lng);
      } else {
        alert('Please detect your location first!');
      }
    });
    document.getElementById('show-forecast').addEventListener('click', () => {
      if (currentLocation) {
        fetchWeatherForecast(currentLocation.lat, currentLocation.lng);
      } else {
        alert('Please detect your location first!');
      }
    });

    // Initialize page with demo data
    window.addEventListener('load', () => {
      // Show demo data immediately
      showDemoWeatherData();
      showDemoForecastData();
      showDemoWeatherAlerts();
      
      // Auto-detect location after a short delay
      setTimeout(() => {
        if (navigator.geolocation) {
          detectLocation();
        }
      }, 1000);
    });
  </script>
</body>
</html>
